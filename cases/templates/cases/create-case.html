{% extends 'cases/base.html' %}

{% block title %}GeneYenta Create Case{% endblock %}

{% block header %} Create a new case {% endblock %}


{% block content %}



{% ssi '/Users/etadministrator/Sites/django_sites/geneyenta_mk3/cases/static/cases/dynatree/dev/FullTree.html' parsed %}



<form name='patient-form' id="form" method="POST">
	 	{% csrf_token %}
	 	<div id='json'>{{patientform.json}}</div>
        {{patientform.as_p}}

        <input type="submit" value="Submit"/>
</form>


<script type="text/javascript">

$('#form').submit(function(evt) {
	var terms = new Array();
	$( ".selected" ).each(function( index ) {
 		var single_term = new Object();
 		
 		//captures the hpo id 
 		var id = $(this).attr('id');
 		single_term.hpo_id = id;

 		//captures the title info
 		single_term.description = $(this).attr('title');

 		//captures the relevancy rating
 		var radio = $(this).find('input:radio[name=importance'+id+']:checked');

        //if radio.length == 0; the radio button hasn't been checked 
        if (radio.length > 0) { 	 	
            single_term.importance = radio.val();
            terms.push(single_term);//adds its to the array
        } else {
            alert('You have not selected an importance rating for \"'+single_term.description+'\".');
            evt.preventDefault();
        }
	});  
	var result = JSON.stringify(terms);
	//alert(result);
	$('#id_patient-json').val(result);//sets the value of the hidden element to the json-string
	//alert($('#id_patient-json').val());
});
 </script>

{% endblock %}

{% block endbody %}


<script src="{{ STATIC_URL }}cases/validate.js" type="text/javascript"></script>
<script type="text/javascript">
var validator = new FormValidator('patient-form', [{
    name: 'patient-case_summary',
    display: '\"Case summary\"',    
    rules: 'required'
}, {
    name: 'patient-institute',
    display: '\"Institute\"',  
    rules: 'required'
}, {
    name: 'patient-clinic',
    display: '\"Clinic\"',
    rules: 'required',
}, {
    name: 'patient-gender',
    display: '\"Gender\"',
    rules: 'required',
}, {
    name: 'patient-first_appointment_date_month', //should be made optional...in models.py
    display: '\"First appointment month field\"',
    rules: 'required',
}, {
	name: 'patient-first_appointment_date_day',
    display: '\"First appointment day field\"',
	rules: 'required'
}, {  
	name: 'patient-first_appointment_date_year',
    display: '\"First appointment year field\"',
	rules: 'required',
}, {
	name: 'patient-first_appointment_age',
    display: '\"First appointment age field\"',
	rules: 'required',
}], function(errors, event) {
    if (errors.length > 0) {
       var errorString = '';  
        for (var i = 0, errorLength = errors.length; i < errorLength; i++) {
            errorString += errors[i].message + '\n';
        }    
        alert('You have left some fields empty!\nPlease remedy these errors before submitting:\n'+errorString);
    	//return false;
    }       
    }

);


</script>
 
{% endblock %}